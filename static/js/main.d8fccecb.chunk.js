(this["webpackJsonpmap-chatr"]=this["webpackJsonpmap-chatr"]||[]).push([[0],{100:function(e,t,a){},105:function(e,t,a){},114:function(e,t,a){},130:function(e,t,a){},134:function(e,t,a){"use strict";a.r(t);var s,c=a(1),n=a(0),o=a.n(n),r=a(14),i=a.n(r),l=(a(80),a(19)),j=a(3),u=a(64),h=a.n(u),d=a(26),b=a.n(d);s="https://swaff-y.github.io/";var m=b.a.create({baseURL:s}),g=(a(99),a(65)),O=a.n(g),f=a(66),x=a.n(f),p=a(40),S=a.n(p),v=a(67),M=a.n(v),N=a(154),E=a(153),C=(a(100),function(e){var t=Object(n.useState)(""),a=Object(j.a)(t,2),s=a[0],o=a[1];Object(n.useEffect)((function(){e.room.lastMessage.length<=15?o(e.room.lastMessage):o(e.room.lastMessage.substring(0,20)+" ...")}),[e.room.lastMessage]),Object(n.useEffect)((function(){e.roomName===e.room.name&&""!==e.lastMessage&&(e.lastMessage.length<=15?o(e.lastMessage):o(e.lastMessage.substring(0,20)+"..."))}),[e.lastMessage]);return Object(c.jsxs)("div",{className:"sidebarChat",onClick:function(){e.handleClick(e.room.name),!0!==e.toggleChatStatus&&e.toggleChat()},children:[Object(c.jsx)(N.a,{}),Object(c.jsxs)("div",{className:"sidebarChat_info",children:[Object(c.jsx)("h2",{children:e.room.name}),Object(c.jsx)("p",{children:s})]})]})}),y=(a(105),function(e){return Object(c.jsxs)("div",{className:"sidebar",children:[Object(c.jsxs)("div",{className:"sidebar_header",children:[Object(c.jsx)(N.a,{src:"https://avatars.githubusercontent.com/u/72368535?s=400&u=20eeecfe9dd1f5a481917319985b2de6d695a80c&v=4"}),Object(c.jsxs)("p",{children:[Object(c.jsx)("strong",{children:"Welcome:"})," ",Object(c.jsx)("br",{}),e.user]}),Object(c.jsxs)("div",{className:"sidebar_headerRight",children:[Object(c.jsx)(E.a,{children:Object(c.jsx)(O.a,{onClick:function(){return e.history.push("/")}})}),Object(c.jsx)(E.a,{children:Object(c.jsx)(x.a,{onClick:function(){return e.toggleChat()}})}),Object(c.jsx)(E.a,{children:Object(c.jsx)(S.a,{onClick:function(){return e.toggleSidebar()}})})]})]}),Object(c.jsx)("div",{className:"sidebar_search",children:Object(c.jsxs)("div",{className:"sidebar_searchContainer",children:[Object(c.jsx)(M.a,{}),Object(c.jsx)("input",{placeholder:"Search",type:"text"})]})}),Object(c.jsx)("div",{className:"sidebar_chats",children:e.chatRooms.map((function(t,a){return Object(c.jsx)(C,{roomName:e.roomName,room:t,lastMessage:e.lastMessage,handleClick:e.handleClick,toggleChat:e.toggleChat,toggleChatStatus:e.chatToggleStatus},a)}))})]})}),_=function(e){return Object(c.jsx)("div",{className:"skinnySidebar",children:Object(c.jsx)("div",{className:"skinnySidebar_headerRight",children:Object(c.jsx)(E.a,{children:Object(c.jsx)(S.a,{onClick:function(){return e.toggleSidebar()}})})})})},w=a(150),U=a(151),k=a(152),I=function(e){return Object(c.jsxs)("div",{className:"chat_header",children:[Object(c.jsx)(N.a,{}),Object(c.jsxs)("div",{className:"chat_headerInfo",children:[Object(c.jsx)("h3",{children:e.roomName}),Object(c.jsxs)("p",{children:["Last post was ",function(e){var t=Math.floor((new Date-e)/1e3),a=t/31536e3;return a>1?1===Math.floor(a)?Math.floor(a)+" year ago..":Math.floor(a)+" years ago..":(a=t/2592e3)>1?1===Math.floor(a)?Math.floor(a)+" month ago..":Math.floor(a)+" months ago..":(a=t/86400)>1?1===Math.floor(a)?Math.floor(a)+" day ago..":Math.floor(a)+" days ago..":(a=t/3600)>1?1===Math.floor(a)?Math.floor(a)+" hour ago..":Math.floor(a)+" hours ago..":(a=t/60)>1?1===Math.floor(a)?Math.floor(a)+" minute ago..":Math.floor(a)+" minutes ago..":" just now.."}(e.roomData.lastTimestamp)]})]}),Object(c.jsxs)("div",{className:"chat_headerRight",children:[Object(c.jsx)(E.a,{children:Object(c.jsx)(w.a,{})}),Object(c.jsx)(E.a,{children:Object(c.jsx)(U.a,{})}),Object(c.jsx)(E.a,{children:Object(c.jsx)(k.a,{onClick:function(){return e.handleToggleThread()}})})]})]})},T=a(68),D=a.n(T),F=function(e){return Object(c.jsx)("div",{children:Object(c.jsx)(D.a,{onEmojiClick:function(t,a){e.getEmoji(a),e.handleToggle()}})})},L=a(70),R=a.n(L),A=a(69),P=a(71),W=a.n(P),B=function(e){return Object(c.jsx)(c.Fragment,{children:Object(c.jsxs)("p",{className:"chat_message ".concat(e.user===e.message.name?"chat_reciever":""),children:[Object(c.jsx)("span",{className:"chat_name",children:e.message.name}),e.message.message,Object(c.jsx)("span",{className:"chat_timestamp",children:function(e){var t=Math.floor((new Date-e)/1e3),a=t/31536e3;return a>1?1===Math.floor(a)?Math.floor(a)+" year ago..":Math.floor(a)+" years ago..":(a=t/2592e3)>1?1===Math.floor(a)?Math.floor(a)+" month ago..":Math.floor(a)+" months ago..":(a=t/86400)>1?1===Math.floor(a)?Math.floor(a)+" day ago..":Math.floor(a)+" days ago..":(a=t/3600)>1?1===Math.floor(a)?Math.floor(a)+" hour ago..":Math.floor(a)+" hours ago..":(a=t/60)>1?1===Math.floor(a)?Math.floor(a)+" minute ago..":Math.floor(a)+" minutes ago..":" just now.."}(e.message.timestamp)})]})})},K=function(e){var t=e.messages,a=Object(n.useState)(!1),s=Object(j.a)(a,2),o=s[0],r=s[1],i=Object(n.useState)(""),l=Object(j.a)(i,2),u=l[0],h=l[1],d=Object(n.useState)(e.latitude),g=Object(j.a)(d,2),O=g[0],f=g[1],x=Object(n.useState)(e.longitude),p=Object(j.a)(x,2),S=p[0],v=p[1],M=Object(n.useState)(!1),N=Object(j.a)(M,2),E=N[0],C=N[1];function y(e){f(e.coords.latitude),v(e.coords.longitude),C(!1)}function _(e){console.warn("Location not set"),b.a.get("https://extreme-ip-lookup.com/json/").then((function(e){f(e.data.lat),v(e.data.lon)})).catch(),C(!0)}Object(n.useEffect)((function(){w()}),[e.messages]),Object(n.useEffect)((function(){document.getElementById("test").focus(),navigator.geolocation.getCurrentPosition(y,_)}),[u]);var w=function(){A.animateScroll.scrollToBottom({containerId:"scroll"})},U=function(){!1===o?r(!0):!0===o&&r(!1)};return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("div",{className:"chat_body",id:"scroll",children:e.messages.map((function(a,s){return t[s].room===e.roomName?Object(c.jsx)(B,{message:a,user:e.user},s):null}))}),!0===E?Object(c.jsxs)("div",{className:"",children:[Object(c.jsx)("strong",{children:"Please turn on your location settings"})," ",Object(c.jsx)("br",{}),"(We are busy using an estimated location based on you IP Address)"]}):null,Object(c.jsxs)("div",{className:"chat_footer",children:[Object(c.jsx)(R.a,{onClick:U}),Object(c.jsxs)("form",{children:[Object(c.jsx)("input",{value:u,onChange:function(e){return h(e.target.value)},placeholder:"Type a message",type:"text",id:"test"}),Object(c.jsx)("button",{onClick:function(t){t.preventDefault(),m.post("/messages/new",{message:u,name:e.user,timestamp:Date.now(),room:e.roomName,latitude:O,longitude:S}).then((function(e){console.log("Message Succesfully sent"),h("")})).catch((function(e){return console.log("I am throwing and error:",e)}))},children:"Send a message"})]}),Object(c.jsx)(W.a,{})]}),!0===o?Object(c.jsx)(F,{getEmoji:function(e){h(u+e.emoji)},handleToggle:U}):null]})},G=function(e){var t=e.participant,a=Object(n.useState)(""),s=Object(j.a)(a,2),o=s[0],r=s[1];return Object(n.useEffect)((function(){t.lastMessage.length<=15?r(t.lastMessage):r(t.lastMessage.substring(0,20)+" ...")}),[t.lastMessage]),Object(c.jsxs)("div",{className:"sidebarChat",children:[Object(c.jsx)(N.a,{}),Object(c.jsxs)("div",{className:"sidebarChat_info",children:[Object(c.jsx)("h2",{children:t.name}),Object(c.jsx)("p",{children:o})]})]})},H=function(e){var t=Object(n.useState)([]),a=Object(j.a)(t,2),s=a[0],o=a[1];return Object(n.useEffect)((function(){m.get("room/".concat(e.roomName)).then((function(e){o(e.data.participants)})).catch((function(e){console.warn(e)}))}),[e.roomName]),Object(c.jsx)("div",{className:"chat_participants",children:s.map((function(e,t){return Object(c.jsx)(G,{participant:e},t)}))})},z=(a(114),function(e){var t=Object(n.useState)(!0),a=Object(j.a)(t,2),s=a[0],o=a[1],r=Object(n.useState)([]),i=Object(j.a)(r,2),l=i[0],u=i[1];Object(n.useEffect)((function(){m.get("room/".concat(e.roomName)).then((function(e){u(e.data)})).catch((function(e){console.warn(e)}))}),[e.messages]);return Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(I,{handleToggleThread:function(){!1===s?o(!0):!0===s&&o(!1)},roomName:e.roomName,roomData:l,latitude:e.latitude,longitude:e.longitude}),!0===s?Object(c.jsx)(K,{messages:e.messages,roomName:e.roomName,user:e.user}):Object(c.jsx)(H,{roomName:e.roomName})]})}),J=a(41),V=Object(J.GoogleApiWrapper)({apiKey:"AIzaSyAW5MNODxdAncbpnSGtOIl6Gyfjo-e6w3g"})((function(e){for(var t=Object(n.useState)(!1),a=Object(j.a)(t,2),s=a[0],o=a[1],r=Object(n.useState)(),i=Object(j.a)(r,2),l=i[0],u=i[1],h=Object(n.useState)({}),d=Object(j.a)(h,2),b=(d[0],d[1],new e.google.maps.LatLngBounds),m=0;m<e.points.length;m++)b.extend(e.points[m]);function g(e,t){for(var a="*",s="";e.length>t;){for(var c=!1,n=t-1;n>=0;n--)if(O(e.charAt(n))){s+=[e.slice(0,n),a].join(""),e=e.slice(n+1),c=!0;break}c||(s+=[e.slice(0,t),a].join(""),e=e.slice(t))}return s+e}function O(e){return new RegExp(/^\s$/).test(e.charAt(0))}Object(n.useEffect)((function(){u(b),o(!0)}),[]);var f={position:"absolute",width:!0===e.width?"58.5%":"85.3%",height:"89.5%"};return Object(c.jsx)("div",{children:e.points.length>0?Object(c.jsx)(J.Map,{google:e.google,zoom:15,style:f,initialCenter:{lat:e.latitude,lng:e.longitude},bounds:!0===s?b:l,children:!0===s?Object.values(e.sortedCoOrds).map((function(t,a){if(t.room===e.roomName)return Object(c.jsx)(J.Marker,{id:a,position:{lat:t.latitude,lng:t.longitude},onClick:function(){return console.log("You clicked me!")},title:g(t.msg,14).split("*")[0],icon:{url:"https://chart.googleapis.com/chart?chst=d_fnote&chld=thought|1|0088FF|h|".concat(g(t.msg,14).split("*")[0],"|").concat(void 0!==g(t.msg,14).split("*")[1]?g(t.msg,14).split("*")[1]:"","|").concat(void 0!==g(t.msg,14).split("*")[2]?g(t.msg,14).split("*")[2]:"")}},a)})):null}):Object(c.jsx)("p",{children:"Loading..."})})})),Y=function(e){var t=Object(n.useState)([]),a=Object(j.a)(t,2),s=a[0],o=a[1],r=Object(n.useState)([]),i=Object(j.a)(r,2),u=i[0],d=i[1],g=Object(n.useState)(!1),O=Object(j.a)(g,2),f=O[0],x=O[1],p=Object(n.useState)(!0),S=Object(j.a)(p,2),v=S[0],M=S[1],N=Object(n.useState)(e.match.params.name),E=Object(j.a)(N,2),C=E[0],w=E[1],U=Object(n.useState)(e.match.params.user),k=Object(j.a)(U,1)[0],I=Object(n.useState)(""),T=Object(j.a)(I,2),D=T[0],F=T[1],L=Object(n.useState)(null),R=Object(j.a)(L,2),A=R[0],P=R[1],W=Object(n.useState)({}),B=Object(j.a)(W,1)[0],K=Object(n.useState)(0),G=Object(j.a)(K,2),H=G[0],J=G[1],Y=Object(n.useState)(0),$=Object(j.a)(Y,2),q=$[0],Q=$[1];Object(n.useEffect)((function(){m.get("/messages/sync/".concat(C)).then((function(e){o(e.data),e.data.forEach((function(e,t){B[e.name]={latitude:e.latitude,longitude:e.longitude,msg:e.message,room:C}}))})).catch((function(e){console.warn(e)})),b.a.get("https://extreme-ip-lookup.com/json/").then((function(e){J(e.data.lat),Q(e.data.lon)})).catch()}),[]),Object(n.useEffect)((function(){m.get("/rooms/sync/".concat(k)).then((function(e){d(e.data)})).catch((function(e){console.warn(e)}))}),[e.match.params.name]),Object(n.useEffect)((function(){var e=new h.a("1bf1ac863ab88a3d0532",{cluster:"ap4"}).subscribe("messages");return e.bind("inserted",(function(e){o([].concat(Object(l.a)(s),[e])),F(e.message),s.forEach((function(e,t){B[e.name]={latitude:e.latitude,longitude:e.longitude,msg:e.message,room:C}}))})),function(){e.unbind_all(),e.unsubscribe()}}),[s]),Object(n.useEffect)((function(){var e=[];s.forEach((function(t,a){e.push({lat:t.latitude,lng:t.longitude})})),P(e)}),[s]);var X=function(){!1===v?M(!0):!0===v&&(M(!1),x(!1))};return Object(c.jsx)("div",{className:"app",children:Object(c.jsxs)("div",{className:"app_body",children:[!0===v?Object(c.jsx)(y,{toggleChat:function(){!1===f?x(!0):!0===f&&x(!1)},chatToggleStatus:f,toggleSidebar:X,chatRooms:u,handleClick:function(t){m.post("/user/".concat(k,"/room/").concat(t)).then((function(e){})).catch((function(e){console.warn(e)})),m.get("/messages/sync/".concat(t)).then((function(e){o(e.data),e.data.forEach((function(e,a){B[e.name]={latitude:e.latitude,longitude:e.longitude,msg:e.message,room:t}}))})).catch((function(e){console.warn(e)})),w(t),e.history.push("/room/".concat(t,"/").concat(k))},lastMessage:D,roomName:C,user:k,history:e.history}):Object(c.jsx)(_,{toggleSidebar:X}),Object(c.jsx)("div",{className:"chat",children:!0===f?Object(c.jsx)(z,{messages:s,roomName:C,user:k,rooms:u,lastMessage:D,latitude:H,longitude:q}):null!==A?Object(c.jsx)(V,{width:v,messages:s,points:A,sortedCoOrds:B,roomName:C,latitude:H,longitude:q}):Object(c.jsx)("p",{children:"Loading..."})})]})})},$=(a(130),function(e){var t=Object(n.useState)([]),a=Object(j.a)(t,2),s=(a[0],a[1]),o=Object(n.useState)(!1),r=Object(j.a)(o,2),i=r[0],l=r[1];Object(n.useEffect)((function(){m.get("/users").then((function(e){s(e.data)})).catch((function(e){console.warn(e)}))}),[]);return Object(c.jsx)(c.Fragment,{children:Object(c.jsxs)("div",{className:"dropdown",children:[Object(c.jsx)("button",{onClick:function(){!0===i?l(!1):!1===i&&l(!0)},className:"dropbtn",children:"Select User"}),!0===i?Object(c.jsxs)("div",{id:"myDropdown",className:"dropdown-content",children:[Object(c.jsx)("a",{href:"#/room/SEI40/User1",children:"User1"}),Object(c.jsx)("a",{href:"#/room/SEI40/User2",children:"User2"}),Object(c.jsx)("a",{href:"#/room/SEI40/User3",children:"User3"}),Object(c.jsx)("a",{href:"#/room/SEI40/User4",children:"User4"}),Object(c.jsx)("a",{href:"#/room/SEI40/User5",children:"User5"}),Object(c.jsx)("a",{href:"#/room/SEI40/User6",children:"User6"}),Object(c.jsx)("a",{href:"#/room/SEI40/User7",children:"User7"}),Object(c.jsx)("a",{href:"#/room/SEI40/User8",children:"User8"}),Object(c.jsx)("a",{href:"#/room/SEI40/User9",children:"User9"}),Object(c.jsx)("a",{href:"#/room/SEI40/User10",children:"User10"}),Object(c.jsx)("a",{href:"#/room/SEI40/User11",children:"User11"})]}):null]})})}),q=a(72),Q=a(6);console.log("Env:",Object({NODE_ENV:"production",PUBLIC_URL:"/mapChat-react",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}));var X=function(){return Object(c.jsx)("div",{className:"app",children:Object(c.jsxs)(q.a,{children:[Object(c.jsx)(Q.a,{exact:!0,path:"/",component:$}),Object(c.jsx)(Q.a,{exact:!0,path:"/user/:user",component:Y}),Object(c.jsx)(Q.a,{exact:!0,path:"/room/:name/:user",component:Y})]})})},Z=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,155)).then((function(t){var a=t.getCLS,s=t.getFID,c=t.getFCP,n=t.getLCP,o=t.getTTFB;a(e),s(e),c(e),n(e),o(e)}))};i.a.render(Object(c.jsx)(o.a.StrictMode,{children:Object(c.jsx)(X,{})}),document.getElementById("root")),Z()},80:function(e,t,a){},99:function(e,t,a){}},[[134,1,2]]]);
//# sourceMappingURL=main.d8fccecb.chunk.js.map