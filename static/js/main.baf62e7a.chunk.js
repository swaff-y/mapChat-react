(this["webpackJsonpmap-chatr"]=this["webpackJsonpmap-chatr"]||[]).push([[0],{100:function(e,t,a){},101:function(e,t,a){},106:function(e,t,a){},130:function(e,t,a){},134:function(e,t,a){"use strict";a.r(t);var s=a(1),o=a(0),n=a.n(o),c=a(14),r=a.n(c),l=(a(81),a(19)),i=a(3),j=a(65),u=a.n(j),h=a(22),m=a.n(h),d=m.a.create({baseURL:"http://localhost:9000"}),b=(a(100),a(66)),g=a.n(b),f=a(67),O=a.n(f),x=a(40),p=a.n(x),v=a(68),M=a.n(v),C=a(154),S=a(153),N=(a(101),function(e){var t=Object(o.useState)(""),a=Object(i.a)(t,2),n=a[0],c=a[1];Object(o.useEffect)((function(){e.room.lastMessage.length<=15?c(e.room.lastMessage):c(e.room.lastMessage.substring(0,20)+" ...")}),[e.room.lastMessage]),Object(o.useEffect)((function(){e.roomName===e.room.name&&""!==e.lastMessage&&(e.lastMessage.length<=15?c(e.lastMessage):c(e.lastMessage.substring(0,20)+"..."))}),[e.lastMessage]);return Object(s.jsxs)("div",{className:"sidebarChat",onClick:function(){e.handleClick(e.room.name),!0!==e.toggleChatStatus&&e.toggleChat()},children:[Object(s.jsx)(C.a,{}),Object(s.jsxs)("div",{className:"sidebarChat_info",children:[Object(s.jsx)("h2",{children:e.room.name}),Object(s.jsx)("p",{children:n})]})]})}),w=(a(106),function(e){var t=Object(o.useState)(""),a=Object(i.a)(t,2),n=a[0],c=a[1],r=Object(o.useState)(null),l=Object(i.a)(r,2),j=l[0],u=l[1];e.chatRooms.forEach((function(e){}));return Object(s.jsxs)("div",{className:"sidebar",children:[Object(s.jsxs)("div",{className:"sidebar_header",children:[Object(s.jsx)(C.a,{src:"https://avatars.githubusercontent.com/u/72368535?s=400&u=20eeecfe9dd1f5a481917319985b2de6d695a80c&v=4"}),Object(s.jsxs)("p",{children:[Object(s.jsx)("strong",{children:"Welcome:"})," ",Object(s.jsx)("br",{}),e.user]}),Object(s.jsxs)("div",{className:"sidebar_headerRight",children:[Object(s.jsx)(S.a,{children:Object(s.jsx)(g.a,{onClick:function(){return e.history.push("/")}})}),Object(s.jsx)(S.a,{children:Object(s.jsx)(O.a,{onClick:function(){return e.toggleChat()}})}),Object(s.jsx)(S.a,{children:Object(s.jsx)(p.a,{onClick:function(){return e.toggleSidebar()}})})]})]}),Object(s.jsx)("div",{className:"sidebar_search",children:Object(s.jsxs)("div",{className:"sidebar_searchContainer",children:[Object(s.jsx)(M.a,{}),Object(s.jsxs)("form",{children:[Object(s.jsx)("input",{placeholder:"Search",type:"text",onChange:function(t){var a=t.target.value;console.log(a),c(a);var s=t.target.value.length-1;console.log(a,s,j);var o=[];null===j?e.chatRooms.forEach((function(e){console.log("room index:",s);var t={};s>=0&&(console.log("here"),a.toLowerCase()===e.name[s].toLowerCase()&&(t.name=e.name,t.lastMessage=e.lastMessage,o.push(t)))})):j.forEach((function(e){var t={};s>=0&&s<1?a.toLowerCase()===e.name[s].toLowerCase()&&(t.name=e.name,t.lastMessage=e.lastMessage,o.push(t)):1===s?a[s].toLowerCase()===e.name[s].toLowerCase()&&(t.name=e.name,t.lastMessage=e.lastMessage,o.push(t)):2===s&&a[s].toLowerCase()===e.name[s].toLowerCase()&&(t.name=e.name,t.lastMessage=e.lastMessage,o.push(t))})),u(s<0?e.chatRooms:o)}}),Object(s.jsx)("input",{type:"submit",className:"hide",onClick:function(){console.log("This is the text: ",n)}})]})]})}),Object(s.jsx)("div",{className:"sidebar_chats",children:null!==j?j.map((function(t,a){return Object(s.jsx)(N,{roomName:e.roomName,room:t,lastMessage:e.lastMessage,handleClick:e.handleClick,toggleChat:e.toggleChat,toggleChatStatus:e.chatToggleStatus},a)})):e.chatRooms.map((function(t,a){return Object(s.jsx)(N,{roomName:e.roomName,room:t,lastMessage:e.lastMessage,handleClick:e.handleClick,toggleChat:e.toggleChat,toggleChatStatus:e.chatToggleStatus},a)}))})]})}),E=function(e){return Object(s.jsx)("div",{className:"skinnySidebar",children:Object(s.jsx)("div",{className:"skinnySidebar_headerRight",children:Object(s.jsx)(S.a,{children:Object(s.jsx)(p.a,{onClick:function(){return e.toggleSidebar()}})})})})},k=a(150),y=a(151),U=a(152),_=function(e){return Object(s.jsxs)("div",{className:"chat_header",children:[Object(s.jsx)(C.a,{}),Object(s.jsxs)("div",{className:"chat_headerInfo",children:[Object(s.jsx)("h3",{children:e.roomName}),Object(s.jsxs)("p",{children:["Last post was ",function(e){var t=Math.floor((new Date-e)/1e3),a=t/31536e3;return a>1?1===Math.floor(a)?Math.floor(a)+" year ago..":Math.floor(a)+" years ago..":(a=t/2592e3)>1?1===Math.floor(a)?Math.floor(a)+" month ago..":Math.floor(a)+" months ago..":(a=t/86400)>1?1===Math.floor(a)?Math.floor(a)+" day ago..":Math.floor(a)+" days ago..":(a=t/3600)>1?1===Math.floor(a)?Math.floor(a)+" hour ago..":Math.floor(a)+" hours ago..":(a=t/60)>1?1===Math.floor(a)?Math.floor(a)+" minute ago..":Math.floor(a)+" minutes ago..":" just now.."}(e.roomData.lastTimestamp)]})]}),Object(s.jsxs)("div",{className:"chat_headerRight",children:[Object(s.jsx)(S.a,{children:Object(s.jsx)(k.a,{})}),Object(s.jsx)(S.a,{children:Object(s.jsx)(y.a,{})}),Object(s.jsx)(S.a,{children:Object(s.jsx)(U.a,{onClick:function(){return e.handleToggleThread()}})})]})]})},T=a(69),I=a.n(T),L=function(e){return Object(s.jsx)("div",{children:Object(s.jsx)(I.a,{onEmojiClick:function(t,a){e.getEmoji(a),e.handleToggle()}})})},D=a(71),F=a.n(D),R=a(70),A=a(72),B=a.n(A),P=function(e){return Object(s.jsx)(s.Fragment,{children:Object(s.jsxs)("p",{className:"chat_message ".concat(e.user===e.message.name?"chat_reciever":""),children:[Object(s.jsx)("span",{className:"chat_name",children:e.message.name}),e.message.message,Object(s.jsx)("span",{className:"chat_timestamp",children:function(e){var t=Math.floor((new Date-e)/1e3),a=t/31536e3;return a>1?1===Math.floor(a)?Math.floor(a)+" year ago..":Math.floor(a)+" years ago..":(a=t/2592e3)>1?1===Math.floor(a)?Math.floor(a)+" month ago..":Math.floor(a)+" months ago..":(a=t/86400)>1?1===Math.floor(a)?Math.floor(a)+" day ago..":Math.floor(a)+" days ago..":(a=t/3600)>1?1===Math.floor(a)?Math.floor(a)+" hour ago..":Math.floor(a)+" hours ago..":(a=t/60)>1?1===Math.floor(a)?Math.floor(a)+" minute ago..":Math.floor(a)+" minutes ago..":" just now.."}(e.message.timestamp)})]})})},W=function(e){var t=e.messages,a=Object(o.useState)(!1),n=Object(i.a)(a,2),c=n[0],r=n[1],l=Object(o.useState)(""),j=Object(i.a)(l,2),u=j[0],h=j[1],b=Object(o.useState)(e.latitude),g=Object(i.a)(b,2),f=g[0],O=g[1],x=Object(o.useState)(e.longitude),p=Object(i.a)(x,2),v=p[0],M=p[1],C=Object(o.useState)(!1),S=Object(i.a)(C,2),N=S[0],w=S[1];function E(e){O(e.coords.latitude),M(e.coords.longitude),w(!1)}function k(e){console.warn("Location not set"),m.a.get("https://extreme-ip-lookup.com/json/").then((function(e){O(e.data.lat),M(e.data.lon)})).catch(),w(!0)}Object(o.useEffect)((function(){y()}),[e.messages]),Object(o.useEffect)((function(){document.getElementById("test").focus(),navigator.geolocation.getCurrentPosition(E,k)}),[u]);var y=function(){R.animateScroll.scrollToBottom({containerId:"scroll"})},U=function(){!1===c?r(!0):!0===c&&r(!1)};return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("div",{className:"chat_body",id:"scroll",children:e.messages.map((function(a,o){return t[o].room===e.roomName?Object(s.jsx)(P,{message:a,user:e.user},o):null}))}),!0===N?Object(s.jsxs)("div",{className:"",children:[Object(s.jsx)("strong",{children:"Please turn on your location settings"})," ",Object(s.jsx)("br",{}),"(We are busy using an estimated location based on you IP Address)"]}):null,Object(s.jsxs)("div",{className:"chat_footer",children:[Object(s.jsx)(F.a,{onClick:U}),Object(s.jsxs)("form",{children:[Object(s.jsx)("input",{value:u,onChange:function(e){return h(e.target.value)},placeholder:"Type a message",type:"text",id:"test"}),Object(s.jsx)("button",{onClick:function(t){t.preventDefault(),f||v?d.post("/messages/new",{message:u,name:e.user,timestamp:Date.now(),room:e.roomName,latitude:f,longitude:v}).then((function(e){console.log("Message Succesfully sent"),h("")})).catch((function(e){return console.log("I am throwing and error:",e)})):console.warn("NO LATITUDE")},children:"Send a message"})]}),Object(s.jsx)(B.a,{})]}),!0===c?Object(s.jsx)(L,{getEmoji:function(e){h(u+e.emoji)},handleToggle:U}):null]})},G=(a(61),function(e){var t=e.participant,a=e.mapClick,n=Object(o.useState)(""),c=Object(i.a)(n,2),r=c[0],l=c[1];return Object(o.useEffect)((function(){t.lastMessage.length<=15?l(t.lastMessage):l(t.lastMessage.substring(0,20)+" ...")}),[t.lastMessage]),console.log("map click:",a,"name:",t.name),Object(s.jsxs)("div",{className:"sidebarChat ".concat(a===t.name?"chat_selected":""),children:[Object(s.jsx)(C.a,{}),Object(s.jsxs)("div",{className:"sidebarChat_info",children:[Object(s.jsx)("h2",{children:t.name}),Object(s.jsx)("p",{children:r})]})]})}),z=function(e){var t=Object(o.useState)([]),a=Object(i.a)(t,2),n=a[0],c=a[1];return Object(o.useEffect)((function(){d.get("room/".concat(e.roomName)).then((function(e){c(e.data.participants)})).catch((function(e){console.warn(e)}))}),[e.roomName]),Object(s.jsx)("div",{className:"chat_participants",children:n.map((function(t,a){return Object(s.jsx)(G,{participant:t,mapClick:e.mapClick},a)}))})},J=function(e){var t=Object(o.useState)([]),a=Object(i.a)(t,2),n=a[0],c=a[1];return Object(o.useEffect)((function(){d.get("room/".concat(e.roomName)).then((function(e){c(e.data)})).catch((function(e){console.warn(e)}))}),[e.messages]),Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)(_,{handleToggleThread:e.handleToggleThread,roomName:e.roomName,roomData:n,latitude:e.latitude,longitude:e.longitude}),!0===e.toggleThread?Object(s.jsx)(W,{messages:e.messages,roomName:e.roomName,user:e.user}):Object(s.jsx)(z,{roomName:e.roomName,mapClick:e.mapClick})]})},K=a(41),$=Object(K.GoogleApiWrapper)({apiKey:"AIzaSyAW5MNODxdAncbpnSGtOIl6Gyfjo-e6w3g"})((function(e){for(var t=Object(o.useState)(!1),a=Object(i.a)(t,2),n=a[0],c=a[1],r=Object(o.useState)(),l=Object(i.a)(r,2),j=l[0],u=l[1],h=Object(o.useState)({}),m=Object(i.a)(h,2),d=(m[0],m[1],new e.google.maps.LatLngBounds),b=0;b<e.points.length;b++)d.extend(e.points[b]);function g(e,t){for(var a="*",s="";e.length>t;){for(var o=!1,n=t-1;n>=0;n--)if(f(e.charAt(n))){s+=[e.slice(0,n),a].join(""),e=e.slice(n+1),o=!0;break}o||(s+=[e.slice(0,t),a].join(""),e=e.slice(t))}return s+e}function f(e){return new RegExp(/^\s$/).test(e.charAt(0))}Object(o.useEffect)((function(){u(d),c(!0)}),[]);var O={position:"absolute",width:!0===e.width?"58.5%":"85.3%",height:"89.5%"};console.log("lat:",e.sortedCoOrds);return Object(s.jsx)("div",{children:e.points.length>0?Object(s.jsx)(K.Map,{google:e.google,zoom:15,style:O,initialCenter:{lat:e.latitude,lng:e.longitude},bounds:!0===n?d:j,children:!0===n?Object.values(e.sortedCoOrds).map((function(t,a){if(t.room===e.roomName)return Object(s.jsx)(K.Marker,{id:a,position:{lat:t.latitude,lng:t.longitude},onClick:function(){return a=t.name,void e.handleMapClick(a);var a},title:g(t.msg,14).split("*")[0],icon:{url:"https://chart.googleapis.com/chart?chst=d_fnote&chld=thought|1|0088FF|h|".concat(g(t.msg,14).split("*")[0],"|").concat(void 0!==g(t.msg,14).split("*")[1]?g(t.msg,14).split("*")[1]:"","|").concat(void 0!==g(t.msg,14).split("*")[2]?g(t.msg,14).split("*")[2]:"")}},a)})):null}):Object(s.jsx)("p",{className:"app_center",children:"No Chats on thread"})})})),q=function(e){var t=Object(o.useState)([]),a=Object(i.a)(t,2),n=a[0],c=a[1],r=Object(o.useState)([]),j=Object(i.a)(r,2),h=j[0],b=j[1],g=Object(o.useState)(!1),f=Object(i.a)(g,2),O=f[0],x=f[1],p=Object(o.useState)(!0),v=Object(i.a)(p,2),M=v[0],C=v[1],S=Object(o.useState)(e.match.params.name),N=Object(i.a)(S,2),k=N[0],y=N[1],U=Object(o.useState)(e.match.params.user),_=Object(i.a)(U,1)[0],T=Object(o.useState)(""),I=Object(i.a)(T,2),L=I[0],D=I[1],F=Object(o.useState)(null),R=Object(i.a)(F,2),A=R[0],B=R[1],P=Object(o.useState)({}),W=Object(i.a)(P,1)[0],G=Object(o.useState)(0),z=Object(i.a)(G,2),K=z[0],q=z[1],H=Object(o.useState)(0),Q=Object(i.a)(H,2),V=Q[0],X=Q[1],Y=Object(o.useState)(""),Z=Object(i.a)(Y,2),ee=Z[0],te=Z[1],ae=Object(o.useState)(!0),se=Object(i.a)(ae,2),oe=se[0],ne=se[1];Object(o.useEffect)((function(){d.get("/messages/sync/".concat(k)).then((function(e){c(e.data),e.data.forEach((function(e,t){W[e.name]={latitude:e.latitude,longitude:e.longitude,msg:e.message,room:k,name:e.name}}))})).catch((function(e){console.warn(e)})),m.a.get("https://extreme-ip-lookup.com/json/").then((function(e){q(e.data.lat),X(e.data.lon)})).catch((function(e){console.warn(e)}))}),[]),Object(o.useEffect)((function(){d.get("/rooms/sync/".concat(_)).then((function(e){b(e.data)})).catch((function(e){console.warn(e)}))}),[e.match.params.name]),Object(o.useEffect)((function(){var e=new u.a("1bf1ac863ab88a3d0532",{cluster:"ap4"}).subscribe("messages");e.bind("inserted",(function(e){n[n.length-1].message!==e.message&&(c([].concat(Object(l.a)(n),[e])),D(e.message),n.forEach((function(e,t){W[e.name]={latitude:e.latitude,longitude:e.longitude,msg:e.message,room:k,name:e.name}})))}));var t=[];return n.forEach((function(e,a){t.push({lat:e.latitude,lng:e.longitude})})),B(t),function(){e.unbind_all(),e.unsubscribe()}}),[n]);var ce=function(){!1===M?C(!0):!0===M&&(C(!1),x(!1))};return Object(s.jsx)("div",{className:"app",children:Object(s.jsxs)("div",{className:"app_body",children:[!0===M?Object(s.jsx)(w,{toggleChat:function(){!1===O?x(!0):!0===O&&x(!1)},chatToggleStatus:O,toggleSidebar:ce,chatRooms:h,handleClick:function(t){d.post("/user/".concat(_,"/room/").concat(t)).then((function(e){})).catch((function(e){console.warn(e)})),d.get("/messages/sync/".concat(t)).then((function(e){c(e.data),e.data.forEach((function(e,a){W[e.name]={latitude:e.latitude,longitude:e.longitude,msg:e.message,room:t,name:e.name}}))})).catch((function(e){console.warn(e)})),y(t),e.history.push("/room/".concat(t,"/").concat(_))},lastMessage:L,roomName:k,user:_,history:e.history}):Object(s.jsx)(E,{toggleSidebar:ce}),Object(s.jsx)("div",{className:"chat",children:!0===O?Object(s.jsx)(J,{messages:n,roomName:k,user:_,rooms:h,lastMessage:L,latitude:K,longitude:V,handleToggleThread:function(){m.a.get("https://extreme-ip-lookup.com/json/").then((function(e){q(e.data.lat),X(e.data.lon)})).catch((function(e){console.warn(e)})),!1===oe?ne(!0):!0===oe&&ne(!1)},toggleThread:oe,mapClick:ee}):null!==A?Object(s.jsx)($,{width:M,messages:n,points:A,sortedCoOrds:W,roomName:k,latitude:K,longitude:V,handleMapClick:function(e){te(e),x(!0),ne(!1)}}):Object(s.jsx)("p",{className:"app_center",children:"No Chats on thread"})})]})})},H=(a(130),function(e){var t=Object(o.useState)([]),a=Object(i.a)(t,2),n=(a[0],a[1]),c=Object(o.useState)(!1),r=Object(i.a)(c,2),l=r[0],j=r[1];Object(o.useEffect)((function(){d.get("/users").then((function(e){n(e.data)})).catch((function(e){console.warn(e)}))}),[]);return Object(s.jsx)(s.Fragment,{children:Object(s.jsxs)("div",{className:"dropdown",children:[Object(s.jsx)("button",{onClick:function(){!0===l?j(!1):!1===l&&j(!0)},className:"dropbtn",children:"Select User"}),!0===l?Object(s.jsxs)("div",{id:"myDropdown",className:"dropdown-content",children:[Object(s.jsx)("a",{href:"#/room/SEI40/User1",children:"User1"}),Object(s.jsx)("a",{href:"#/room/SEI40/User2",children:"User2"}),Object(s.jsx)("a",{href:"#/room/SEI40/User3",children:"User3"}),Object(s.jsx)("a",{href:"#/room/SEI40/User4",children:"User4"}),Object(s.jsx)("a",{href:"#/room/SEI40/User5",children:"User5"}),Object(s.jsx)("a",{href:"#/room/SEI40/User6",children:"User6"}),Object(s.jsx)("a",{href:"#/room/SEI40/User7",children:"User7"}),Object(s.jsx)("a",{href:"#/room/SEI40/User8",children:"User8"}),Object(s.jsx)("a",{href:"#/room/SEI40/User9",children:"User9"}),Object(s.jsx)("a",{href:"#/room/SEI40/User10",children:"User10"}),Object(s.jsx)("a",{href:"#/room/SEI40/User11",children:"User11"})]}):null]})})}),Q=a(73),V=a(6),X=function(){return Object(s.jsx)("div",{className:"app",children:Object(s.jsxs)(Q.a,{children:[Object(s.jsx)(V.a,{exact:!0,path:"/",component:H}),Object(s.jsx)(V.a,{exact:!0,path:"/user/:user",component:q}),Object(s.jsx)(V.a,{exact:!0,path:"/room/:name/:user",component:q})]})})},Y=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,155)).then((function(t){var a=t.getCLS,s=t.getFID,o=t.getFCP,n=t.getLCP,c=t.getTTFB;a(e),s(e),o(e),n(e),c(e)}))};r.a.render(Object(s.jsx)(n.a.StrictMode,{children:Object(s.jsx)(X,{})}),document.getElementById("root")),Y()},61:function(e,t,a){},81:function(e,t,a){}},[[134,1,2]]]);
//# sourceMappingURL=main.baf62e7a.chunk.js.map